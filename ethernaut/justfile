
set dotenv-load

launch:
    docker-compose up --build -d

# This recipe conditionally runs the CoinFlip bash script or a standard forge script.
solve testName:
    @docker-compose up -d

    @if [ "{{testName}}" == "CoinFlip" ]; then \
        echo "Running the automated CoinFlip script..."; \
        ./sh/run_coin_flip.sh {{env_var('SEPOLIA_RPC_URL')}} sepoliaKey; \
    elif [ "{{testName}}" == "Telephone" ]; then \
        ./sh/run_telephone.sh {{env_var('SEPOLIA_RPC_URL')}} sepoliaKey; \
    else \
        echo "Running the standard forge script for {{testName}}..."; \
        docker exec -it foundry-dev forge script script/{{testName}}Attacker.s.sol \
            --rpc-url {{env_var('SEPOLIA_RPC_URL')}} \
            --account sepoliaKey \
            --password-file .password \
            --broadcast -vvvv --tc {{testName}}Attacker; \
    fi

getGK1GastOffset:
    docker exec -d foundry-dev anvil --host 0.0.0.0 --fork-url {{env_var('SEPOLIA_RPC_URL')}} --fork-block-number latest

    export LOCAL_RPC_URL=http://127.0.0.1:8545

    sleep 5  # wait for anvil to start up

    @docker-compose up -d

    echo "Running Gatekeeper One gas estimation with GatekeeperOneAttack contract"; \
    docker exec -it foundry-dev forge script script/GatekeeperOneGasCalculator.s.sol \
        --rpc-url {{env_var('LOCAL_RPC_URL')}} \
        --account sepoliaKey \
        --password-file .password \
        --broadcast -vvvv --tc GatekeeperOneGasCalculator; \
